<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>2026é¦¬å¹´ç¾é£Ÿè£½ä½œéŠæˆ² - æ”¤ä½ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Microsoft JhengHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: url('images/bg.png') no-repeat center center;
            background-size: cover;
            color: #333;
            touch-action: manipulation; /* ç¦ç”¨é›™æ“Šæ”¾å¤§ */
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            padding: 1vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* è£é£¾å…ƒç´  */
        .decoration {
            position: absolute;
            font-size: 2vh;
            color: #ffd700;
            z-index: 1;
            animation: float 3s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-0.8vh); }
        }
        
        .dec-1 { top: 2vh; left: 2vw; }
        .dec-2 { top: 2vh; right: 2vw; }
        .dec-3 { bottom: 2vh; left: 2vw; }
        .dec-4 { bottom: 2vh; right: 2vw; }
        
        .year-badge {
            background: linear-gradient(45deg, #8B4513, #ffd700, #D2691E);
            color: white;
            padding: 1vh 2.5vw;
            border-radius: 3vh;
            font-size: 1.5vh;
            font-weight: bold;
            margin: 1vh auto;
            display: inline-block;
            border: 0.3vh solid #ffd700;
            box-shadow: 0 0.5vh 1.5vh rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
            text-shadow: 0.1vh 0.1vh 0.2vh rgba(0,0,0,0.3);
            z-index: 2;
            position: relative;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .header {
            text-align: center;
            margin-bottom: 1.5vh;
            position: relative;
            z-index: 2;
            flex-shrink: 0;
        }
        
        .header h1 {
            color: #8B4513;
            font-size: 2.2vh;
            text-shadow: 0.2vh 0.2vh 0 #ffd700;
            margin-bottom: 0.8vh;
            letter-spacing: 0.1vh;
        }
        
        .header p {
            color: #555;
            font-size: 1.1vh;
            line-height: 1.4;
            max-width: 90%;
            margin: 0 auto;
        }
        
        /* éŠæˆ²å€åŸŸ */
        .game-area {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            overflow: hidden;
            flex: 1;
        }
        
        /* ä¸»èœå–® */
        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2vh;
            margin: auto;
            width: 100%;
            max-width: 40vw;
            flex: 1;
        }
        
        .menu-button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 1.8vh 2.5vw;
            font-size: 1.5vh;
            border-radius: 5vh;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border: 0.5vh solid #ffd700;
            box-shadow: 0 0.8vh 0 #5D2906;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.2vw;
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .menu-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .menu-button:hover::before {
            left: 100%;
        }
        
        .menu-button:hover {
            background-color: #5D2906;
            transform: translateY(-0.3vh);
            box-shadow: 0 1.1vh 0 #5D2906;
        }
        
        .menu-button:active {
            transform: translateY(0.3vh);
            box-shadow: 0 0.5vh 0 #5D2906;
        }
        
        .menu-button i {
            font-size: 1.8vh;
        }
        
        /* é£Ÿç‰©é¸æ“‡å€åŸŸ */
        .food-selection {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .food-selection-title {
            text-align: center;
            color: #8B4513;
            font-size: 1.8vh;
            margin-bottom: 1.5vh;
            font-weight: bold;
            width: 100%;
            text-shadow: 0.1vh 0.1vh 0 #ffd700;
            flex-shrink: 0;
        }
        
        .food-cards-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 0.5vh;
            width: 33.33vw;
            margin: 0 auto;
            padding: 0;
            flex: 1;
            overflow: hidden;
            justify-items: center;
            align-items: center;
            max-height: calc(100vh - 25vh); /* ç¢ºä¿ä¸æœƒè¶…å‡ºå±å¹• */
        }
        
        .food-card {
            background: linear-gradient(145deg, #fff9e6, #ffecb3);
            border-radius: 1.5vh;
            padding: 1.5vh 1vw;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 0.4vh solid #ffd700;
            box-shadow: 0 0.6vh 1.2vh rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 14vh;
            height: 14vh;
            margin: 0;
        }
        
        .food-card:hover {
            transform: translateY(-0.5vh) scale(1.05);
            box-shadow: 0 1.2vh 2vh rgba(0, 0, 0, 0.15);
            border-color: #8B4513;
        }
        
        .food-card.selected {
            border-color: #8B4513;
            background: linear-gradient(145deg, #ffeaa7, #ffd93d);
            transform: translateY(-0.3vh);
        }
        
        .food-icon {
            font-size: 2.5vh;
            margin-bottom: 0.8vh;
            color: #8B4513;
            height: 4.5vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .food-name {
            font-size: 1.2vh;
            color: #8B4513;
            margin-bottom: 0.5vh;
            font-weight: bold;
        }
        
        .food-desc {
            color: #666;
            font-size: 0.8vh;
            line-height: 1.2;
            margin-bottom: 0.8vh;
        }
        
        .food-stats {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 0.8vh;
            margin-top: auto;
        }
        
        /* éŠæˆ²äº’å‹•å€åŸŸ */
        .interaction-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        
        .steps-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 1vh;
            flex-wrap: wrap;
            gap: 0.8vh;
            flex-shrink: 0;
        }
        
        .step-dot {
            width: 3.5vh;
            height: 3.5vh;
            border-radius: 50%;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1vh;
            font-weight: bold;
            color: #888;
            border: 0.2vh solid #ddd;
            transition: all 0.3s;
        }
        
        .step-dot.active {
            background-color: #ffd700;
            color: #8B4513;
            border-color: #8B4513;
            transform: scale(1.1);
        }
        
        .step-dot.completed {
            background-color: #8B4513;
            color: white;
            border-color: #ffd700;
        }
        
        /* è£½ä½œå€ä¿ç•™ç™½è‰²èƒŒæ™¯å’Œé»ƒè‰²é‚Šæ¡† */
        .interaction-area {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 2vh;
            box-shadow: 0 1vh 3vh rgba(0, 0, 0, 0.3);
            padding: 1.5vh;
            border: 0.8vh solid #ffd700;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            flex: 1;
            overflow: hidden;
            position: relative;
            margin-top: 1vh;
            max-height: calc(100vh - 20vh); /* ç¢ºä¿ä¸æœƒè¶…å‡ºå±å¹• */
        }
        
        .step-title {
            text-align: center;
            color: #8B4513;
            font-size: 1.6vh;
            margin-bottom: 0.8vh;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .step-instruction {
            text-align: center;
            color: #666;
            font-size: 1.1vh;
            margin-bottom: 1.5vh;
            padding: 0 1vw;
            line-height: 1.4;
            flex-shrink: 0;
        }
        
        /* äº’å‹•å…§å®¹å€åŸŸ */
        .interaction-content {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            padding: 0.5vh;
            position: relative;
            max-height: calc(100% - 20vh);
        }
        
        /* é»æ“Šæ­¥é©Ÿæ¨£å¼ */
        .ingredients-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            position: relative;
            max-height: calc(100% - 15vh);
            overflow: hidden;
        }
        
        .ingredients {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1vh;
            margin-bottom: 1vh;
            width: 100%;
            overflow-y: auto;
            padding: 0.5vh;
            max-height: calc(100% - 8vh);
        }
        
        .ingredient {
            width: 8vh;
            height: 8vh;
            border-radius: 1.2vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 0.3vh solid #ccc;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0.8vh;
            user-select: none;
            position: relative;
            flex-shrink: 0;
        }
        
        .ingredient:hover {
            transform: scale(1.05);
            box-shadow: 0 0.6vh 1.2vh rgba(0, 0, 0, 0.1);
        }
        
        .ingredient.correct {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .ingredient.wrong {
            border-color: #f44336;
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        .ingredient.placed {
            opacity: 0.6;
            border-style: dashed;
            border-color: #ffd700;
            background-color: #f9f9f9;
            cursor: default;
        }
        
        .ingredient.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .ingredient.disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .ingredient-icon {
            font-size: 1.8vh;
            margin-bottom: 0.5vh;
        }
        
        .ingredient-name {
            font-size: 0.8vh;
            color: #555;
            text-align: center;
            font-weight: bold;
        }
        
        /* é€²åº¦æ¢æ­¥é©Ÿæ¨£å¼ */
        .progress-container {
            width: 90%;
            height: 2.5vh;
            background-color: #eee;
            border-radius: 1.5vh;
            margin: 2vh 0;
            overflow: hidden;
            border: 0.3vh solid #ddd;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #ffd700;
            width: 0%;
            transition: width 0.5s;
            border-radius: 1.5vh;
        }
        
        .progress-text {
            font-size: 1.2vh;
            color: #8B4513;
            font-weight: bold;
            margin-top: 1vh;
        }
        
        /* è¨ˆæ•¸å™¨æ­¥é©Ÿæ¨£å¼ */
        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2vw;
            margin: 2.5vh 0;
            font-size: 1.5vh;
            color: #8B4513;
        }
        
        .counter-button {
            width: 5vh;
            height: 5vh;
            border-radius: 50%;
            background-color: #8B4513;
            color: white;
            border: none;
            font-size: 2vh;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border: 0.3vh solid #ffd700;
        }
        
        .counter-button:hover {
            background-color: #5D2906;
            transform: scale(1.05);
        }
        
        .counter-button:active {
            transform: scale(0.95);
        }
        
        .counter-button:disabled {
            background-color: #aaa;
            border-color: #777;
            cursor: not-allowed;
            transform: none;
        }
        
        .counter-value {
            min-width: 7vh;
            text-align: center;
            font-weight: bold;
            font-size: 2.2vh;
            background-color: #fff9e6;
            padding: 1vh 1.5vw;
            border-radius: 1vh;
            border: 0.2vh solid #ffd700;
        }
        
        /* å®Œæˆç•«é¢ */
        .completion-screen {
            text-align: center;
            padding: 1.5vh;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .completion-icon {
            font-size: 5vh;
            margin-bottom: 2vh;
            color: #8B4513;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-1.5vh); }
        }
        
        .completion-message {
            color: #8B4513;
            font-size: 1.8vh;
            margin-bottom: 1.5vh;
            font-weight: bold;
        }
        
        .completion-desc {
            color: #666;
            font-size: 1vh;
            margin-bottom: 2vh;
            max-width: 90%;
            line-height: 1.4;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* å°èˆªæŒ‰éˆ• */
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5vh;
            margin-top: 2vh;
            width: 100%;
            padding: 0 1.5vh;
            z-index: 10;
            position: relative;
            bottom: auto;
            flex-shrink: 0;
        }
        
        .nav-button {
            background-color: #ffd700;
            color: #8B4513;
            border: none;
            padding: 1.2vh 2vw;
            font-size: 1.1vh;
            border-radius: 3vh;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border: 0.3vh solid #8B4513;
            min-width: 12vh;
        }
        
        .nav-button:hover {
            background-color: #8B4513;
            color: #ffd700;
            transform: scale(1.05);
        }
        
        .nav-button:disabled {
            background-color: #aaa;
            color: #777;
            border-color: #777;
            cursor: not-allowed;
            transform: none;
        }
        
        .action-button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 1.2vh 2.5vw;
            font-size: 1.2vh;
            border-radius: 4vh;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1.5vh;
            font-weight: bold;
            border: 0.4vh solid #ffd700;
            box-shadow: 0 0.6vh 0 #5D2906;
            min-width: 15vh;
        }
        
        .action-button:hover {
            background-color: #5D2906;
            transform: translateY(-0.3vh);
            box-shadow: 0 0.9vh 0 #5D2906;
        }
        
        .action-button:active {
            transform: translateY(0.3vh);
            box-shadow: 0 0.3vh 0 #5D2906;
        }
        
        .action-button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 0.6vh 0 #777;
            border-color: #777;
        }
        
        /* æ’è¡Œæ¦œ */
        .leaderboard-container {
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 2vh;
            padding: 1.5vh;
            border: 0.8vh solid #ffd700;
            box-shadow: 0 1vh 3vh rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .leaderboard-title {
            text-align: center;
            color: #8B4513;
            font-size: 1.8vh;
            margin-bottom: 1.5vh;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .leaderboard-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8vh;
            margin-bottom: 1.5vh;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .leaderboard-tab {
            background-color: #ffd700;
            color: #8B4513;
            border: 0.2vh solid #8B4513;
            padding: 0.8vh 1.2vw;
            border-radius: 2vh;
            cursor: pointer;
            font-size: 0.9vh;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 8vh;
        }
        
        .leaderboard-tab:hover {
            background-color: #8B4513;
            color: #ffd700;
        }
        
        .leaderboard-tab.active {
            background-color: #8B4513;
            color: #ffd700;
            box-shadow: 0 0.3vh 0.8vh rgba(0,0,0,0.2);
        }
        
        .leaderboard-table-container {
            flex: 1;
            overflow: auto;
            max-height: calc(100vh - 25vh);
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 1vh;
            overflow: hidden;
            box-shadow: 0 0.3vh 0.8vh rgba(0,0,0,0.1);
        }
        
        .leaderboard-table th {
            background-color: #8B4513;
            color: white;
            padding: 1.2vh;
            text-align: left;
            font-size: 1vh;
            position: sticky;
            top: 0;
        }
        
        .leaderboard-table td {
            padding: 1.2vh;
            border-bottom: 0.2vh solid #ffd700;
            font-size: 0.9vh;
        }
        
        .leaderboard-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        .leaderboard-table tr:hover {
            background-color: rgba(255, 215, 0, 0.2);
        }
        
        .rank-1 { color: #ffd700; font-weight: bold; font-size: 1.1vh; }
        .rank-2 { color: #c0c0c0; font-weight: bold; font-size: 1vh; }
        .rank-3 { color: #cd7f32; font-weight: bold; font-size: 1vh; }
        
        /* å§“åè¼¸å…¥è¡¨å–® */
        .name-form {
            background-color: white;
            padding: 2vh;
            border-radius: 1.5vh;
            border: 0.4vh solid #ffd700;
            max-width: 90%;
            margin: 0 auto;
            text-align: center;
            box-shadow: 0 0.6vh 1.5vh rgba(0,0,0,0.1);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 50vw;
            z-index: 100;
        }
        
        .name-form h2 {
            color: #8B4513;
            margin-bottom: 1.5vh;
            font-size: 1.8vh;
        }
        
        .name-input {
            width: 100%;
            padding: 1.2vh;
            font-size: 1.3vh;
            border: 0.3vh solid #ffd700;
            border-radius: 1vh;
            margin-bottom: 2vh;
            text-align: center;
            color: #8B4513;
            transition: all 0.3s;
        }
        
        .name-input:focus {
            outline: none;
            border-color: #8B4513;
            box-shadow: 0 0 1vh rgba(139, 69, 19, 0.3);
            transform: scale(1.02);
        }
        
        .character-selection {
            display: flex;
            justify-content: center;
            gap: 1.5vh;
            margin: 1.5vh 0;
            flex-wrap: wrap;
        }
        
        .character-option {
            width: 6vh;
            height: 6vh;
            border-radius: 50%;
            border: 0.3vh solid #ffd700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2vh;
            background-color: white;
            transition: all 0.3s;
        }
        
        .character-option:hover {
            transform: scale(1.05);
            border-color: #8B4513;
        }
        
        .character-option.selected {
            border-color: #8B4513;
            background-color: #ffd700;
            transform: scale(1.05);
            box-shadow: 0 0.3vh 0.8vh rgba(0,0,0,0.2);
        }
        
        .submit-button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 1.5vh 3vw;
            font-size: 1.3vh;
            border-radius: 4vh;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border: 0.4vh solid #ffd700;
            box-shadow: 0 0.6vh 0 #5D2906;
            width: 100%;
            margin-top: 1vh;
        }
        
        .submit-button:hover {
            background-color: #5D2906;
            transform: translateY(-0.3vh);
            box-shadow: 0 0.9vh 0 #5D2906;
        }
        
        .submit-button:active {
            transform: translateY(0.3vh);
            box-shadow: 0 0.3vh 0 #5D2906;
        }
        
        /* éš±è—é¡ */
        .hidden {
            display: none !important;
        }
        
        /* éŒ¯èª¤è¨Šæ¯ */
        .error-message {
            color: #f44336;
            font-size: 1vh;
            margin-top: 0.4vh;
            text-align: center;
            font-weight: bold;
            animation: shake 0.5s;
            padding: 0.8vh 1.5vw;
            background-color: rgba(244, 67, 54, 0.1);
            border-radius: 0.8vh;
            border: 0.2vh solid #f44336;
        }
        
        .success-message {
            color: #4CAF50;
            font-size: 1vh;
            margin-top: 0.4vh;
            text-align: center;
            font-weight: bold;
            padding: 0.8vh 1.5vw;
            background-color: rgba(76, 175, 80, 0.1);
            border-radius: 0.8vh;
            border: 0.2vh solid #4CAF50;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-0.3vh); }
            20%, 40%, 60%, 80% { transform: translateX(0.3vh); }
        }
        
        /* é£Ÿæè¨ˆæ•¸å™¨ */
        .ingredient-counter {
            font-size: 1.1vh;
            color: #8B4513;
            margin-bottom: 1vh;
            text-align: center;
            font-weight: bold;
            padding: 0.8vh 1.5vw;
            background-color: #fff9e6;
            border-radius: 0.8vh;
            border: 0.2vh solid #ffd700;
            display: inline-block;
            flex-shrink: 0;
        }
        
        /* è¨Šæ¯å€åŸŸ */
        .message-area {
            width: 100%;
            max-width: 90%;
            margin-top: 2vh;
            margin-bottom: 1vh;
            min-height: 6vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            flex-shrink: 0;
            overflow-y: auto;
            max-height: 8vh;
            padding: 0.5vh;
            background-color: transparent;
            border: none;
            position: relative;
        }
        
        /* è¿”å›æŒ‰éˆ• */
        .back-button {
            position: absolute;
            top: 1.5vh;
            left: 1.5vw;
            background-color: #8B4513;
            color: white;
            border: none;
            width: 4vh;
            height: 4vh;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 0.2vh solid #ffd700;
            z-index: 10;
        }
        
        .back-button:hover {
            background-color: #5D2906;
            transform: scale(1.1);
        }
        
        /* éŸ³æ•ˆæŒ‰éˆ• */
        .sound-toggle {
            position: absolute;
            top: 1.5vh;
            right: 1.5vw;
            width: 4vh;
            height: 4vh;
            border-radius: 50%;
            background-color: #ffd700;
            color: #8B4513;
            border: 0.2vh solid #8B4513;
            font-size: 1.2vh;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
        }
        
        /* è§¸æ‘¸è¨­å‚™å„ªåŒ– */
        .clickable {
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .clickable:active {
            transform: scale(0.95);
        }
        
        /* é˜²æ­¢æ–‡å­—é¸æ“‡ */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* é¦¬å¹´ç‰¹åˆ¥ä¸»é¡Œ */
        .horse-theme {
            background-image: 
                radial-gradient(#ffd700 0.1vh, transparent 0.1vh),
                radial-gradient(#8B4513 0.1vh, transparent 0.1vh),
                linear-gradient(45deg, transparent 30%, rgba(255, 215, 0, 0.1) 100%);
        }
        
        .horse-decoration {
            font-size: 2.5vh;
            animation: horseFloat 4s infinite ease-in-out;
        }
        
        @keyframes horseFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-1vh) rotate(5deg); }
            75% { transform: translateY(0.5vh) rotate(-5deg); }
        }
        
        /* æ©«å±å°ˆç”¨å„ªåŒ– */
        @media (orientation: landscape) {
            .header h1 {
                font-size: 1.8vh;
            }
            
            .header p {
                font-size: 0.9vh;
            }
            
            .year-badge {
                font-size: 1.2vh;
                padding: 0.8vh 2vw;
            }
            
            .food-card {
                width: 12vh;
                height: 12vh;
            }
            
            .food-icon {
                font-size: 2vh;
                height: 3.5vh;
            }
            
            .food-name {
                font-size: 1.1vh;
            }
            
            .ingredient {
                width: 7vh;
                height: 7vh;
            }
            
            .leaderboard-tabs {
                gap: 0.6vh;
            }
            
            .leaderboard-tab {
                padding: 0.6vh 1vw;
                font-size: 0.8vh;
                min-width: 7vh;
            }
            
            .menu-button {
                padding: 1.5vh 2vw;
                font-size: 1.3vh;
            }
            
            .menu-button i {
                font-size: 1.5vh;
            }
            
            /* ç¢ºä¿ææ–™å€åŸŸä¸è¶…å‡º */
            .ingredients {
                max-height: calc(100% - 10vh);
            }
            
            .message-area {
                min-height: 5vh;
                max-height: 7vh;
            }
            
            .food-cards-container {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(3, 1fr);
                width: 33.33vw;
            }
        }
        
        /* ç…™èŠ±æ•ˆæœ */
        .fireworks {
            position: fixed;
            width: 0.8vh;
            height: 0.8vh;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="decoration dec-1 horse-decoration">ğŸ´</div>
        <div class="decoration dec-2">ğŸ§§</div>
        <div class="decoration dec-3">ğŸ®</div>
        <div class="decoration dec-4 horse-decoration">ğŸ‡</div>
        
        <!-- å¹´ä»½æ¨™èªŒ -->
        <div class="year-badge">ğŸ® 2026 æ–°å¹´å¿«æ¨‚ ğŸ®</div>
        
        <!-- éŸ³æ•ˆé–‹é—œ -->
        <button class="sound-toggle" id="sound-toggle">ğŸ”Š</button>
        
        <div class="header">
            <h1>2026é¦¬å¹´ç¾é£Ÿè£½ä½œæŒ‘æˆ°</h1>
            <p>æ­¡è¿ä¾†åˆ°æ–°æ˜¥å»šæˆ¿ï¼é¸æ“‡ç¾é£Ÿé–‹å§‹è£½ä½œï¼ŒæŒ‘æˆ°æ’è¡Œæ¦œï¼ğŸ´ é¦¬åˆ°æˆåŠŸï¼</p>
        </div>
        
        <div class="game-area">
            <!-- ä¸»èœå–® -->
            <div id="main-menu" class="main-menu">
                <button id="play-button" class="menu-button clickable">
                    <i class="fas fa-play-circle"></i> é–‹å§‹æŒ‘æˆ°
                </button>
                <button id="leaderboard-button" class="menu-button clickable">
                    <i class="fas fa-trophy"></i> æ’è¡Œæ¦œ
                </button>
            </div>
            
            <!-- éŠæˆ²é¸æ“‡å€åŸŸ -->
            <div id="selection-area" class="food-selection hidden">
                <!-- è¿”å›æŒ‰éˆ• -->
                <button class="back-button clickable" id="back-to-menu-from-selection">â†</button>
                <!-- ç¾é£Ÿå°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <!-- äº’å‹•å€åŸŸ -->
            <div id="interaction-area" class="interaction-container hidden">
                <!-- è¿”å›æŒ‰éˆ• -->
                <button class="back-button clickable" id="back-to-menu-from-game">â†</button>
                
                <!-- æ­¥é©ŸæŒ‡ç¤ºå™¨ -->
                <div id="steps-indicator" class="steps-indicator">
                    <!-- æ­¥é©ŸæŒ‡ç¤ºé»å°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <div class="interaction-area">
                    <h2 id="step-title" class="step-title">æ­¥é©Ÿ1: æº–å‚™ææ–™</h2>
                    <p id="step-instruction" class="step-instruction">é»æ“Šæ­£ç¢ºçš„é£ŸæåŠ å…¥åˆ°ç¢—è£¡é¢</p>
                    
                    <!-- é£Ÿæè¨ˆæ•¸å™¨ -->
                    <div id="ingredient-counter-display" class="ingredient-counter hidden">
                        å·²é¸æ“‡: <span id="selected-count">0</span>/<span id="total-ingredients">0</span>
                    </div>
                    
                    <!-- é€šç”¨äº’å‹•å€åŸŸ -->
                    <div id="interaction-content" class="interaction-content">
                        <!-- å…§å®¹å°‡æ ¹æ“šæ­¥é©Ÿå‹•æ…‹æ›´æ–° -->
                    </div>
                    
                    <!-- è¨Šæ¯å€åŸŸ -->
                    <div id="message-area" class="message-area"></div>
                    
                    <!-- å°èˆªæŒ‰éˆ• -->
                    <div class="navigation-buttons">
                        <button id="prev-step" class="nav-button clickable hidden">ä¸Šä¸€æ­¥</button>
                        <button id="next-step" class="nav-button clickable" disabled>ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
            
            <!-- æ’è¡Œæ¦œå€åŸŸ -->
            <div id="leaderboard-area" class="leaderboard-container hidden">
                <!-- è¿”å›æŒ‰éˆ• -->
                <button class="back-button clickable" id="back-to-menu-from-leaderboard">â†</button>
                
                <h2 class="leaderboard-title">ğŸ† æ’è¡Œæ¦œ ğŸ†</h2>
                
                <div class="leaderboard-tabs">
                    <button class="leaderboard-tab active" data-food="all">ç¸½æ’è¡Œæ¦œ</button>
                    <button class="leaderboard-tab" data-food="dumpling">ğŸ¥Ÿ é¤ƒå­</button>
                    <button class="leaderboard-tab" data-food="springRoll">ğŸŒ¯ æ˜¥æ²</button>
                    <button class="leaderboard-tab" data-food="riceCake">ğŸš å¹´ç³•</button>
                    <button class="leaderboard-tab" data-food="tangyuan">ğŸŸ¡ æ¹¯åœ“</button>
                    <button class="leaderboard-tab" data-food="fish">ğŸŸ å¹´å¹´æœ‰é­š</button>
                    <button class="leaderboard-tab" data-food="longevityNoodle">ğŸœ é•·å£½éºµ</button>
                    <button class="leaderboard-tab" data-food="turnipCake">ğŸ¥® è˜¿è””ç³•</button>
                    <button class="leaderboard-tab" data-food="hotPot">ğŸ² ç«é‹</button>
                    <button class="leaderboard-tab" data-food="eightTreasureRice">ğŸš å…«å¯¶é£¯</button>
                </div>
                
                <div class="leaderboard-table-container">
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th width="15%">æ’å</th>
                                <th width="30%">ç©å®¶</th>
                                <th width="30%">ç¾é£Ÿ</th>
                                <th width="25%">åˆ†æ•¸</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- æ’è¡Œæ¦œæ•¸æ“šå°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- å§“åè¼¸å…¥è¡¨å–® -->
            <div id="name-form" class="name-form hidden">
                <h2>ğŸ‰ æŒ‘æˆ°å®Œæˆï¼</h2>
                <p style="font-size: 1.2vh; margin-bottom: 2vh; color: #666;">
                    ä½ ç²å¾—äº† <span id="final-score" style="color: #8B4513; font-weight: bold;">0</span> åˆ†ï¼
                </p>
                
                <h3>é¸æ“‡ä½ çš„é ­åƒï¼š</h3>
                <div class="character-selection">
                    <div class="character-option clickable" data-char="ğŸ‘¨â€ğŸ³">ğŸ‘¨â€ğŸ³</div>
                    <div class="character-option clickable" data-char="ğŸ‘©â€ğŸ³">ğŸ‘©â€ğŸ³</div>
                    <div class="character-option clickable" data-char="ğŸ´">ğŸ´</div>
                    <div class="character-option clickable" data-char="ğŸ§§">ğŸ§§</div>
                </div>
                
                <h3 style="margin-top: 2vh;">è¼¸å…¥ä½ çš„åå­—ï¼š</h3>
                <input type="text" id="player-name" class="name-input" placeholder="è¼¸å…¥ä½ çš„åå­—" maxlength="12">
                <button id="submit-score" class="submit-button clickable">ç™»ä¸Šæ’è¡Œæ¦œï¼</button>
            </div>
        </div>
    </div>

    <!-- éŸ³æ•ˆ -->
    <audio id="correct-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrong-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    <audio id="complete-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="click-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ============================================
        // éŠæˆ²æ ¸å¿ƒè®Šé‡
        // ============================================
        let currentFood = null;
        let currentStep = 0;
        let totalSteps = 0;
        let gameState = {};
        let soundEnabled = true;
        let selectedCharacter = "ğŸ‘¨â€ğŸ³";
        let leaderboardData = [];
        let scoreAlreadySubmitted = false;
        
        // ä¿®å¾©é»æ“Šå•é¡Œ
        let isProcessingClick = false;
        
        // ============================================
        // éŠæˆ²DOMå…ƒç´ 
        // ============================================
        const mainMenu = document.getElementById('main-menu');
        const playButton = document.getElementById('play-button');
        const leaderboardButton = document.getElementById('leaderboard-button');
        const selectionArea = document.getElementById('selection-area');
        const stepsIndicator = document.getElementById('steps-indicator');
        const interactionArea = document.getElementById('interaction-area');
        const stepTitle = document.getElementById('step-title');
        const stepInstruction = document.getElementById('step-instruction');
        const interactionContent = document.getElementById('interaction-content');
        const prevStepButton = document.getElementById('prev-step');
        const nextStepButton = document.getElementById('next-step');
        const leaderboardArea = document.getElementById('leaderboard-area');
        const nameForm = document.getElementById('name-form');
        const playerNameInput = document.getElementById('player-name');
        const submitScoreButton = document.getElementById('submit-score');
        const finalScoreEl = document.getElementById('final-score');
        const soundToggle = document.getElementById('sound-toggle');
        const backToMenuFromSelection = document.getElementById('back-to-menu-from-selection');
        const backToMenuFromGame = document.getElementById('back-to-menu-from-game');
        const backToMenuFromLeaderboard = document.getElementById('back-to-menu-from-leaderboard');
        const leaderboardTabs = document.querySelectorAll('.leaderboard-tab');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const ingredientCounterDisplay = document.getElementById('ingredient-counter-display');
        const selectedCountEl = document.getElementById('selected-count');
        const totalIngredientsEl = document.getElementById('total-ingredients');
        const messageArea = document.getElementById('message-area');
        
        // ============================================
        // éŠæˆ²æ•¸æ“šå®šç¾©
        // ============================================
        
        // å¹²æ“¾ææ–™åº«
        const wrongIngredients = [
            { icon: "ğŸ«", name: "å·§å…‹åŠ›" },
            { icon: "ğŸ¦", name: "å†°æ·‡æ·‹" },
            { icon: "ğŸ•", name: "æŠ«è–©" },
            { icon: "ğŸ”", name: "æ¼¢å ¡" },
            { icon: "ğŸŸ", name: "è–¯æ¢" },
            { icon: "ğŸ¥¤", name: "æ±½æ°´" },
            { icon: "ğŸ©", name: "ç”œç”œåœˆ" },
            { icon: "ğŸª", name: "é¤…ä¹¾" },
            { icon: "ğŸ§€", name: "èµ·å¸" },
            { icon: "ğŸ¥“", name: "åŸ¹æ ¹" },
            { icon: "ğŸŒ", name: "é¦™è•‰" },
            { icon: "ğŸ", name: "è˜‹æœ" },
            { icon: "ğŸ‡", name: "è‘¡è„" },
            { icon: "ğŸ“", name: "è‰è“" }
        ];
        
        // ç¾é£Ÿæ­¥é©Ÿå®šç¾© - 10ç¨®ç¾é£Ÿï¼ˆå·²ç§»é™¤é³³æ¢¨é…¥ï¼‰
        const foodSteps = {
            dumpling: {
                name: "é¤ƒå­",
                icon: "ğŸ¥Ÿ",
                desc: "å‚³çµ±æ˜¥ç¯€ç¾é£Ÿï¼Œåœ˜åœ“è±¡å¾µ",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡è£½ä½œé¤ƒå­çš®çš„ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŒ¾", name: "éºµç²‰" },
                            { icon: "ğŸ’§", name: "æ°´" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ‰è£½éºµåœ˜",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ‰è£½éºµåœ˜",
                        type: "progress",
                        actionText: "æ‰éºµåœ˜",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æº–å‚™é¤¡æ–™",
                        instruction: "é¸æ“‡é¤ƒå­é¤¡æ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ¥©", name: "è±¬è‚‰" },
                            { icon: "ğŸ¥¬", name: "ç™½èœ" },
                            { icon: "ğŸ§‚", name: "é†¬æ²¹" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "åŒ…é¤ƒå­",
                        instruction: "é»æ“ŠæŒ‰éˆ•åŒ…é¤ƒå­",
                        type: "counter",
                        targetCount: 6,
                        actionText: "åŒ…ä¸€å€‹",
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            springRoll: {
                name: "æ˜¥æ²",
                icon: "ğŸŒ¯",
                desc: "è„†é¦™å¯å£ï¼Œæ˜¥ç¯€å¿…å‚™",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡æ˜¥æ²çš®ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŒ¾", name: "éºµç²‰" },
                            { icon: "ğŸ’§", name: "æ°´" },
                            { icon: "ğŸ¥š", name: "é›è›‹" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "è£½ä½œéºµç³Š",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ”ªæ‹Œéºµç³Š",
                        type: "progress",
                        actionText: "æ”ªæ‹Œ",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æº–å‚™é¤¡æ–™",
                        instruction: "é¸æ“‡æ˜¥æ²é¤¡æ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ¥•", name: "èƒ¡è˜¿è””" },
                            { icon: "ğŸ¥¬", name: "é«˜éº—èœ" },
                            { icon: "ğŸ„", name: "é¦™è‡" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ²æ˜¥æ²",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ²æ˜¥æ²",
                        type: "counter",
                        targetCount: 5,
                        actionText: "æ²ä¸€å€‹",
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            riceCake: {
                name: "å¹´ç³•",
                icon: "ğŸš",
                desc: "å¹´å¹´é«˜å‡ï¼Œç”œèœœç¾å‘³",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡å¹´ç³•ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŒ¾", name: "ç³¯ç±³ç²‰" },
                            { icon: "ğŸ’§", name: "æ°´" },
                            { icon: "ğŸ¯", name: "ç³–" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ··åˆææ–™",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ”ªæ‹Œ",
                        type: "progress",
                        actionText: "æ”ªæ‹Œ",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "è’¸å¹´ç³•",
                        instruction: "é»æ“ŠæŒ‰éˆ•è’¸ç…®",
                        type: "progress",
                        actionText: "è’¸ç…®",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "è£é£¾",
                        instruction: "é¸æ“‡è£é£¾ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸƒ", name: "è‘‰å­" },
                            { icon: "ğŸŒ¸", name: "èŠ±æœµ" }
                        ],
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            tangyuan: {
                name: "æ¹¯åœ“",
                icon: "ğŸŸ¡",
                desc: "åœ˜åœ˜åœ“åœ“ï¼Œç”œèœœå¹¸ç¦",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡æ¹¯åœ“çš®ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŒ¾", name: "ç³¯ç±³ç²‰" },
                            { icon: "ğŸ’§", name: "æ°´" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ‰ç³¯ç±³ç³°",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ‰è£½",
                        type: "progress",
                        actionText: "æ‰ç³°",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æº–å‚™é¤¡æ–™",
                        instruction: "é¸æ“‡æ¹¯åœ“é¤¡æ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "âš«", name: "é»‘èŠéº»" },
                            { icon: "ğŸ¯", name: "ç³–" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "åŒ…æ¹¯åœ“",
                        instruction: "é»æ“ŠæŒ‰éˆ•åŒ…æ¹¯åœ“",
                        type: "counter",
                        targetCount: 6,
                        actionText: "åŒ…ä¸€å€‹",
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            fish: {
                name: "å¹´å¹´æœ‰é­š",
                icon: "ğŸŸ",
                desc: "å¹´å¹´æœ‰é¤˜ï¼Œå‰ç¥¥å¦‚æ„",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡ä¸»è¦ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŸ", name: "é­š" },
                            { icon: "ğŸ§‚", name: "é¹½" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "é†ƒè£½é­š",
                        instruction: "é»æ“ŠæŒ‰éˆ•é†ƒè£½",
                        type: "progress",
                        actionText: "é†ƒè£½",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æº–å‚™é…æ–™",
                        instruction: "é¸æ“‡è’¸é­šé…æ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ§…", name: "è”¥" },
                            { icon: "ğŸ§„", name: "è–‘" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "è’¸é­š",
                        instruction: "é»æ“ŠæŒ‰éˆ•è’¸é­š",
                        type: "progress",
                        actionText: "è’¸ç…®",
                        targetProgress: 100,
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            longevityNoodle: {
                name: "é•·å£½éºµ",
                icon: "ğŸœ",
                desc: "é•·é•·ä¹…ä¹…ï¼Œå¥åº·é•·å£½",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡éºµæ¢ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŒ¾", name: "éºµç²‰" },
                            { icon: "ğŸ’§", name: "æ°´" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ‰è£½éºµåœ˜",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ‰éºµ",
                        type: "progress",
                        actionText: "æ‰éºµ",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ“€éºµ",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ“€éºµ",
                        type: "progress",
                        actionText: "æ“€éºµ",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "åˆ‡éºµæ¢",
                        instruction: "é»æ“ŠæŒ‰éˆ•åˆ‡éºµ",
                        type: "counter",
                        targetCount: 8,
                        actionText: "åˆ‡éºµ",
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            turnipCake: {
                name: "è˜¿è””ç³•",
                icon: "ğŸ¥®",
                desc: "æ­¥æ­¥é«˜å‡ï¼Œå¥½é‹é€£é€£",
                steps: [
                    {
                        title: "æº–å‚™ææ–™",
                        instruction: "é¸æ“‡è˜¿è””ç³•ä¸»è¦ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ¥•", name: "ç™½è˜¿è””" },
                            { icon: "ğŸŒ¾", name: "ç±³ç²‰" },
                            { icon: "ğŸ’§", name: "æ°´" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ··åˆææ–™",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ”ªæ‹Œææ–™",
                        type: "progress",
                        actionText: "æ”ªæ‹Œ",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "è’¸ç…®",
                        instruction: "é»æ“ŠæŒ‰éˆ•è’¸ç…®è˜¿è””ç³•",
                        type: "progress",
                        actionText: "è’¸ç…®",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "ç…è˜¿è””ç³•",
                        instruction: "é»æ“ŠæŒ‰éˆ•ç…è‡³é‡‘é»ƒ",
                        type: "progress",
                        actionText: "ç…ç…®",
                        targetProgress: 100,
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            hotPot: {
                name: "ç«é‹",
                icon: "ğŸ²",
                desc: "åœ˜åœ˜åœ“åœ“ï¼Œç†±é¬§éå‡¡",
                steps: [
                    {
                        title: "æº–å‚™æ¹¯åº•",
                        instruction: "é¸æ“‡ç«é‹æ¹¯åº•ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ¥¬", name: "é«˜æ¹¯" },
                            { icon: "ğŸŒ¶ï¸", name: "è¾£æ¤’" },
                            { icon: "ğŸ§„", name: "è’œé ­" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "ç…®æ¹¯åº•",
                        instruction: "é»æ“ŠæŒ‰éˆ•ç…®æ¹¯åº•",
                        type: "progress",
                        actionText: "ç…®æ²¸",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æº–å‚™é£Ÿæ",
                        instruction: "é¸æ“‡ç«é‹é£Ÿæ",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ¥©", name: "ç‰›è‚‰" },
                            { icon: "ğŸ„", name: "è˜‘è‡" },
                            { icon: "ğŸ¥¬", name: "é’èœ" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æ¶®é£Ÿæ",
                        instruction: "é»æ“ŠæŒ‰éˆ•æ¶®é£Ÿæ",
                        type: "counter",
                        targetCount: 6,
                        actionText: "æ¶®ä¸€ä¸‹",
                        nextButton: "å®Œæˆ"
                    }
                ]
            },
            eightTreasureRice: {
                name: "å…«å¯¶é£¯",
                icon: "ğŸš",
                desc: "å‰ç¥¥å¦‚æ„ï¼Œç”œç”œèœœèœœ",
                steps: [
                    {
                        title: "æº–å‚™ç³¯ç±³",
                        instruction: "é¸æ“‡ä¸»è¦ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸŒ¾", name: "ç³¯ç±³" },
                            { icon: "ğŸ’§", name: "æ°´" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "è’¸ç³¯ç±³",
                        instruction: "é»æ“ŠæŒ‰éˆ•è’¸ç³¯ç±³",
                        type: "progress",
                        actionText: "è’¸ç…®",
                        targetProgress: 100,
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "æº–å‚™å…«å¯¶",
                        instruction: "é¸æ“‡å…«å¯¶ææ–™",
                        type: "click",
                        correctIngredients: [
                            { icon: "ğŸ¯", name: "èœ‚èœœ" },
                            { icon: "ğŸŒ°", name: "æ —å­" },
                            { icon: "ğŸ«˜", name: "ç´…è±†" }
                        ],
                        nextButton: "ä¸‹ä¸€æ­¥"
                    },
                    {
                        title: "çµ„è£å…«å¯¶é£¯",
                        instruction: "é»æ“ŠæŒ‰éˆ•çµ„è£",
                        type: "progress",
                        actionText: "çµ„è£",
                        targetProgress: 100,
                        nextButton: "å®Œæˆ"
                    }
                ]
            }
        };
        
        // ============================================
        // éŠæˆ²åˆå§‹åŒ–
        // ============================================
        
        // å¾æœ¬åœ°å­˜å„²åŠ è¼‰éŠæˆ²æ•¸æ“š
        function loadGameData() {
            const savedData = localStorage.getItem('foodGameLeaderboard');
            if (savedData) {
                try {
                    leaderboardData = JSON.parse(savedData);
                } catch (e) {
                    console.error("åŠ è¼‰æ’è¡Œæ¦œæ•¸æ“šéŒ¯èª¤:", e);
                    leaderboardData = [];
                }
            } else {
                leaderboardData = [];
            }
            
            // åŠ è¼‰éŸ³æ•ˆè¨­ç½®
            const soundSetting = localStorage.getItem('foodGameSound');
            if (soundSetting !== null) {
                soundEnabled = soundSetting === 'true';
            }
            updateSoundToggle();
        }
        
        // ä¿å­˜éŠæˆ²æ•¸æ“šåˆ°æœ¬åœ°å­˜å„²
        function saveGameData() {
            try {
                localStorage.setItem('foodGameLeaderboard', JSON.stringify(leaderboardData));
                localStorage.setItem('foodGameSound', soundEnabled.toString());
            } catch (e) {
                console.error("ä¿å­˜éŠæˆ²æ•¸æ“šéŒ¯èª¤:", e);
            }
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            // åŠ è¼‰éŠæˆ²æ•¸æ“š
            loadGameData();
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            playButton.addEventListener('click', showFoodSelection);
            leaderboardButton.addEventListener('click', showLeaderboard);
            soundToggle.addEventListener('click', toggleSound);
            
            // è¿”å›æŒ‰éˆ•
            backToMenuFromSelection.addEventListener('click', showMainMenu);
            backToMenuFromGame.addEventListener('click', showMainMenu);
            backToMenuFromLeaderboard.addEventListener('click', showMainMenu);
            
            // å°èˆªæŒ‰éˆ•
            nextStepButton.addEventListener('click', goToNextStep);
            prevStepButton.addEventListener('click', goToPrevStep);
            
            // æäº¤åˆ†æ•¸
            submitScoreButton.addEventListener('click', submitScore);
            
            // è§’è‰²é¸æ“‡
            document.querySelectorAll('.character-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (isProcessingClick) return;
                    isProcessingClick = true;
                    
                    document.querySelectorAll('.character-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedCharacter = this.dataset.char;
                    
                    playSound('click-sound');
                    
                    setTimeout(() => { isProcessingClick = false; }, 300);
                });
            });
            
            // æ’è¡Œæ¦œæ¨™ç±¤
            leaderboardTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    if (isProcessingClick) return;
                    isProcessingClick = true;
                    
                    const food = this.dataset.food;
                    leaderboardTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    updateLeaderboard(food);
                    
                    playSound('click-sound');
                    
                    setTimeout(() => { isProcessingClick = false; }, 300);
                });
            });
            
            // é¡¯ç¤ºä¸»èœå–®
            showMainMenu();
        }
        
        // ============================================
        // éŠæˆ²åŠŸèƒ½å‡½æ•¸
        // ============================================
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(soundId) {
            if (!soundEnabled) return;
            
            try {
                const sound = document.getElementById(soundId);
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±æ•—:", e));
                }
            } catch (e) {
                console.log("éŸ³æ•ˆæ’­æ”¾éŒ¯èª¤:", e);
            }
        }
        
        // åˆ‡æ›éŸ³æ•ˆ
        function toggleSound() {
            soundEnabled = !soundEnabled;
            updateSoundToggle();
            saveGameData();
            playSound('click-sound');
        }
        
        // æ›´æ–°éŸ³æ•ˆæŒ‰éˆ•
        function updateSoundToggle() {
            soundToggle.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }
        
        // é¡¯ç¤ºä¸»èœå–®
        function showMainMenu() {
            if (isProcessingClick) return;
            isProcessingClick = true;
            
            // éš±è—æ‰€æœ‰å€åŸŸ
            selectionArea.classList.add('hidden');
            interactionArea.classList.add('hidden');
            leaderboardArea.classList.add('hidden');
            nameForm.classList.add('hidden');
            
            // é¡¯ç¤ºä¸»èœå–®
            mainMenu.classList.remove('hidden');
            
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            currentFood = null;
            currentStep = 0;
            gameState = {};
            scoreAlreadySubmitted = false;
            
            // ä¿®å¾©BUGï¼šé‡ç½®ä¸‹ä¸€æ­¥æŒ‰éˆ•ç‹€æ…‹
            if (nextStepButton) {
                nextStepButton.disabled = false;
                nextStepButton.textContent = "ä¸‹ä¸€æ­¥";
            }
            if (prevStepButton) {
                prevStepButton.classList.add('hidden');
            }
            
            playSound('click-sound');
            
            setTimeout(() => { isProcessingClick = false; }, 300);
        }
        
        // é¡¯ç¤ºç¾é£Ÿé¸æ“‡
        function showFoodSelection() {
            if (isProcessingClick) return;
            isProcessingClick = true;
            
            mainMenu.classList.add('hidden');
            selectionArea.classList.remove('hidden');
            
            // å‰µå»ºç¾é£Ÿå¡ç‰‡
            createFoodCards();
            
            playSound('click-sound');
            
            setTimeout(() => { isProcessingClick = false; }, 300);
        }
        
        // é¡¯ç¤ºæ’è¡Œæ¦œ
        function showLeaderboard() {
            if (isProcessingClick) return;
            isProcessingClick = true;
            
            mainMenu.classList.add('hidden');
            leaderboardArea.classList.remove('hidden');
            
            // æ›´æ–°æ’è¡Œæ¦œ
            updateLeaderboard('all');
            
            playSound('click-sound');
            
            setTimeout(() => { isProcessingClick = false; }, 300);
        }
        
        // å‰µå»ºç¾é£Ÿå¡ç‰‡
        function createFoodCards() {
            selectionArea.innerHTML = '';
            
            // æ·»åŠ æ¨™é¡Œ
            const title = document.createElement('div');
            title.className = 'food-selection-title';
            title.textContent = 'é¸æ“‡æ˜¥ç¯€ç¾é£Ÿé–‹å§‹æŒ‘æˆ°ï¼š';
            selectionArea.appendChild(title);
            
            // å‰µå»ºå¡ç‰‡å®¹å™¨
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'food-cards-container';
            
            // å‰µå»ºæ¯å€‹ç¾é£Ÿçš„å¡ç‰‡
            Object.keys(foodSteps).forEach((foodId) => {
                const food = foodSteps[foodId];
                
                const foodCard = document.createElement('div');
                foodCard.className = 'food-card clickable no-select';
                foodCard.dataset.food = foodId;
                
                foodCard.innerHTML = `
                    <div class="food-icon">${food.icon}</div>
                    <div class="food-name">${food.name}</div>
                    <div class="food-desc">${food.desc}</div>
                    <div class="food-stats">
                        <span>æ­¥é©Ÿ: ${food.steps.length}</span>
                    </div>
                `;
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                foodCard.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    if (isProcessingClick) return;
                    isProcessingClick = true;
                    
                    playSound('click-sound');
                    
                    // æ›´æ–°é¸ä¸­ç‹€æ…‹
                    document.querySelectorAll('.food-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // è¨­ç½®ç•¶å‰é¸ä¸­çš„ç¾é£Ÿ
                    currentFood = foodId;
                    
                    // é–‹å§‹è£½ä½œç¾é£Ÿ
                    setTimeout(() => {
                        startFoodMaking(foodId);
                        isProcessingClick = false;
                    }, 300);
                });
                
                cardsContainer.appendChild(foodCard);
            });
            
            selectionArea.appendChild(cardsContainer);
        }
        
        // é–‹å§‹è£½ä½œç¾é£Ÿ
        function startFoodMaking(foodType) {
            selectionArea.classList.add('hidden');
            interactionArea.classList.remove('hidden');
            
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            currentStep = 0;
            gameState = {
                clickedIngredients: [],
                progress: 0,
                counter: 0,
                wrongSelections: 0,
                startTime: Date.now(),
                perfect: true
            };
            
            // é‡ç½®åˆ†æ•¸æäº¤ç‹€æ…‹
            scoreAlreadySubmitted = false;
            
            // å‰µå»ºæ­¥é©ŸæŒ‡ç¤ºå™¨
            createStepIndicators(foodType);
            
            // è¼‰å…¥ç¬¬ä¸€æ­¥
            loadStep(foodType, 0);
        }
        
        // å‰µå»ºæ­¥é©ŸæŒ‡ç¤ºå™¨
        function createStepIndicators(foodType) {
            stepsIndicator.innerHTML = '';
            totalSteps = foodSteps[foodType].steps.length;
            
            for (let i = 0; i < totalSteps; i++) {
                const stepDot = document.createElement('div');
                stepDot.className = 'step-dot';
                stepDot.textContent = i + 1;
                stepDot.dataset.step = i;
                
                if (i === 0) {
                    stepDot.classList.add('active');
                }
                
                stepsIndicator.appendChild(stepDot);
            }
        }
        
        // è¼‰å…¥æ­¥é©Ÿ
        function loadStep(foodType, stepIndex) {
            currentStep = stepIndex;
            const step = foodSteps[foodType].steps[stepIndex];
            
            // æ›´æ–°æ­¥é©ŸæŒ‡ç¤ºå™¨
            updateStepIndicators();
            
            // æ›´æ–°æ¨™é¡Œå’Œèªªæ˜
            stepTitle.textContent = `æ­¥é©Ÿ${stepIndex + 1}: ${step.title}`;
            stepInstruction.textContent = step.instruction;
            
            // æ›´æ–°äº’å‹•å…§å®¹
            interactionContent.innerHTML = '';
            ingredientCounterDisplay.classList.add('hidden');
            
            // æ¸…ç©ºè¨Šæ¯å€åŸŸ
            clearMessageArea();
            
            // æ ¹æ“šæ­¥é©Ÿé¡å‹è¼‰å…¥ä¸åŒçš„äº’å‹•å…§å®¹
            switch(step.type) {
                case "click":
                    loadClickStep(step);
                    break;
                case "progress":
                    loadProgressStep(step);
                    break;
                case "counter":
                    loadCounterStep(step);
                    break;
            }
            
            // æ›´æ–°ä¸‹ä¸€æ­¥æŒ‰éˆ•æ–‡å­—å’Œç‹€æ…‹
            nextStepButton.textContent = step.nextButton;
            nextStepButton.disabled = true;
            
            // é¡¯ç¤º/éš±è—ä¸Šä¸€æ­¥æŒ‰éˆ•
            if (stepIndex > 0) {
                prevStepButton.classList.remove('hidden');
            } else {
                prevStepButton.classList.add('hidden');
            }
        }
        
        // æ›´æ–°æ­¥é©ŸæŒ‡ç¤ºå™¨
        function updateStepIndicators() {
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                
                if (index === currentStep) {
                    dot.classList.add('active');
                } else if (index < currentStep) {
                    dot.classList.add('completed');
                }
            });
        }
        
        // è¼‰å…¥é»æ“Šæ­¥é©Ÿ
        function loadClickStep(step) {
            // å‰µå»ºææ–™å€åŸŸ
            const ingredientsContainer = document.createElement('div');
            ingredientsContainer.className = 'ingredients-container';
            
            // é¡¯ç¤ºé£Ÿæè¨ˆæ•¸å™¨
            ingredientCounterDisplay.classList.remove('hidden');
            selectedCountEl.textContent = '0';
            totalIngredientsEl.textContent = step.correctIngredients.length;
            
            const ingredientsDiv = document.createElement('div');
            ingredientsDiv.className = 'ingredients';
            
            // æº–å‚™æ‰€æœ‰ææ–™ï¼šæ­£ç¢ºææ–™ + å¹²æ“¾ææ–™
            const allIngredients = [...step.correctIngredients];
            
            // æ·»åŠ å¹²æ“¾ææ–™
            const numWrongIngredients = Math.max(step.correctIngredients.length, 4);
            const shuffledWrongIngredients = [...wrongIngredients]
                .sort(() => 0.5 - Math.random())
                .slice(0, numWrongIngredients);
            
            allIngredients.push(...shuffledWrongIngredients);
            
            // éš¨æ©Ÿæ’åºæ‰€æœ‰ææ–™
            const shuffledAllIngredients = allIngredients.sort(() => 0.5 - Math.random());
            
            // å‰µå»ºææ–™å…ƒç´ 
            shuffledAllIngredients.forEach(ingredient => {
                const isCorrect = step.correctIngredients.some(ci => ci.name === ingredient.name);
                
                const ingredientDiv = document.createElement('div');
                ingredientDiv.className = `ingredient clickable no-select`;
                ingredientDiv.dataset.name = ingredient.name;
                ingredientDiv.dataset.correct = isCorrect;
                
                // æ·»åŠ æ­£ç¢º/éŒ¯èª¤æ¨£å¼
                if (isCorrect) {
                    ingredientDiv.classList.add('correct');
                } else {
                    ingredientDiv.classList.add('wrong');
                }
                
                ingredientDiv.innerHTML = `
                    <div class="ingredient-icon">${ingredient.icon}</div>
                    <div class="ingredient-name">${ingredient.name}</div>
                `;
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                ingredientDiv.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    if (isProcessingClick) return;
                    isProcessingClick = true;
                    
                    handleIngredientClick(this, ingredient, isCorrect, step);
                    
                    setTimeout(() => { isProcessingClick = false; }, 300);
                });
                
                ingredientsDiv.appendChild(ingredientDiv);
            });
            
            ingredientsContainer.appendChild(ingredientsDiv);
            
            interactionContent.appendChild(ingredientsContainer);
            
            // é‡ç½®é»æ“Šç‹€æ…‹
            gameState.clickedIngredients = [];
            gameState.wrongSelections = 0;
        }
        
        // è™•ç†ææ–™é»æ“Š
        function handleIngredientClick(ingredientDiv, ingredient, isCorrect, step) {
            playSound('click-sound');
            
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“é»æ“Šé
            if (ingredientDiv.classList.contains('placed') || ingredientDiv.classList.contains('disabled')) {
                return;
            }
            
            if (isCorrect) {
                // æ­£ç¢ºææ–™
                gameState.clickedIngredients.push(ingredient.name);
                ingredientDiv.classList.add('placed');
                ingredientDiv.classList.add('disabled');
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                showMessage(`âœ“ é¸æ“‡äº† ${ingredient.name}`, true);
                
                playSound('correct-sound');
                
                // æ›´æ–°è¨ˆæ•¸å™¨
                selectedCountEl.textContent = gameState.clickedIngredients.length;
                
                // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰æ­£ç¢ºææ–™éƒ½å·²æ·»åŠ 
                if (gameState.clickedIngredients.length === step.correctIngredients.length) {
                    nextStepButton.disabled = false;
                    
                    showMessage('ğŸ‰ æ‰€æœ‰ææ–™å·²æº–å‚™å¥½ï¼å¯ä»¥ç¹¼çºŒä¸‹ä¸€æ­¥äº†ï¼', true);
                }
            } else {
                // éŒ¯èª¤ææ–™
                gameState.wrongSelections++;
                gameState.perfect = false;
                
                ingredientDiv.classList.add('disabled');
                
                // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                showMessage(`âœ— ${ingredient.name} ä¸æ˜¯æ­£ç¢ºææ–™ï¼`, false);
                
                playSound('wrong-sound');
                
                // é–ƒçˆæ•ˆæœ
                ingredientDiv.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    ingredientDiv.style.animation = '';
                }, 500);
            }
        }
        
        // é¡¯ç¤ºè¨Šæ¯åˆ°è¨Šæ¯å€åŸŸ
        function showMessage(message, isSuccess) {
            const messageElement = document.createElement('div');
            messageElement.className = isSuccess ? 'success-message' : 'error-message';
            messageElement.textContent = message;
            
            // æ·»åŠ åˆ°è¨Šæ¯å€åŸŸé ‚éƒ¨ï¼Œé€™æ¨£æ–°è¨Šæ¯æœƒå‡ºç¾åœ¨æœ€ä¸Šæ–¹
            messageArea.insertBefore(messageElement, messageArea.firstChild);
            
            // å¦‚æœè¨Šæ¯å¤ªå¤šï¼Œç§»é™¤æœ€èˆŠçš„è¨Šæ¯
            const maxMessages = 3;
            while (messageArea.children.length > maxMessages) {
                messageArea.removeChild(messageArea.lastChild);
            }
            
            // è¨­å®š3ç§’å¾Œè‡ªå‹•ç§»é™¤é€™æ¢è¨Šæ¯
            setTimeout(() => {
                if (messageElement.parentNode === messageArea) {
                    messageArea.removeChild(messageElement);
                }
            }, 3000);
        }
        
        // æ¸…ç©ºè¨Šæ¯å€åŸŸ
        function clearMessageArea() {
            messageArea.innerHTML = '';
        }
        
        // è¼‰å…¥é€²åº¦æ¢æ­¥é©Ÿ
        function loadProgressStep(step) {
            const progressContainer = document.createElement('div');
            progressContainer.className = 'progress-container';
            progressContainer.innerHTML = `
                <div class="progress-bar" id="progress-bar"></div>
            `;
            
            const progressText = document.createElement('div');
            progressText.className = 'progress-text';
            progressText.id = 'progress-text';
            progressText.textContent = '0%';
            
            const actionButton = document.createElement('button');
            actionButton.className = 'action-button clickable';
            actionButton.id = 'action-button';
            actionButton.textContent = step.actionText;
            
            interactionContent.appendChild(progressContainer);
            interactionContent.appendChild(progressText);
            interactionContent.appendChild(actionButton);
            
            // é‡ç½®é€²åº¦ç‹€æ…‹
            gameState.progress = 0;
            updateProgressBar();
            
            // æ·»åŠ é»æ“Šäº‹ä»¶
            actionButton.addEventListener('click', function() {
                if (isProcessingClick) return;
                isProcessingClick = true;
                
                playSound('click-sound');
                
                const increment = 20;
                
                if (gameState.progress < step.targetProgress) {
                    gameState.progress += increment;
                    if (gameState.progress > step.targetProgress) {
                        gameState.progress = step.targetProgress;
                    }
                    updateProgressBar();
                    
                    // å®Œæˆæ™‚å•Ÿç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
                    if (gameState.progress >= step.targetProgress) {
                        nextStepButton.disabled = false;
                        this.disabled = true;
                    }
                }
                
                setTimeout(() => { isProcessingClick = false; }, 200);
            });
        }
        
        // è¼‰å…¥è¨ˆæ•¸å™¨æ­¥é©Ÿ
        function loadCounterStep(step) {
            const counterDiv = document.createElement('div');
            counterDiv.className = 'counter';
            counterDiv.innerHTML = `
                <button class="counter-button clickable" id="increase-button">+</button>
                <div class="counter-value" id="counter-value">0</div>
            `;
            
            const actionText = document.createElement('div');
            actionText.className = 'step-instruction';
            actionText.textContent = `ç›®æ¨™: ${step.targetCount} æ¬¡ ${step.actionText}`;
            
            interactionContent.appendChild(actionText);
            interactionContent.appendChild(counterDiv);
            
            // é‡ç½®è¨ˆæ•¸å™¨ç‹€æ…‹
            gameState.counter = 0;
            updateCounter();
            
            // æ·»åŠ è¨ˆæ•¸å™¨äº‹ä»¶
            const increaseButton = document.getElementById('increase-button');
            increaseButton.addEventListener('click', function() {
                if (isProcessingClick) return;
                isProcessingClick = true;
                
                playSound('click-sound');
                
                if (gameState.counter < step.targetCount) {
                    gameState.counter++;
                    updateCounter();
                    
                    // å®Œæˆæ™‚å•Ÿç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
                    if (gameState.counter >= step.targetCount) {
                        nextStepButton.disabled = false;
                        this.disabled = true;
                    }
                }
                
                setTimeout(() => { isProcessingClick = false; }, 200);
            });
        }
        
        // æ›´æ–°é€²åº¦æ¢
        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            if (progressBar && progressText) {
                progressBar.style.width = `${gameState.progress}%`;
                progressText.textContent = `${gameState.progress}%`;
                
                // å®Œæˆæ™‚æ·»åŠ å½©è‰²æ•ˆæœ
                if (gameState.progress >= 100) {
                    progressBar.classList.add('colorful-progress');
                }
            }
        }
        
        // æ›´æ–°è¨ˆæ•¸å™¨
        function updateCounter() {
            const counterValue = document.getElementById('counter-value');
            if (counterValue) {
                counterValue.textContent = gameState.counter;
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function goToNextStep() {
            if (isProcessingClick) return;
            isProcessingClick = true;
            
            playSound('click-sound');
            
            if (currentStep < totalSteps - 1) {
                loadStep(currentFood, currentStep + 1);
            } else {
                // å®Œæˆæ‰€æœ‰æ­¥é©Ÿ
                showCompletionScreen();
            }
            
            setTimeout(() => { isProcessingClick = false; }, 300);
        }
        
        // ä¸Šä¸€æ­¥
        function goToPrevStep() {
            if (isProcessingClick) return;
            isProcessingClick = true;
            
            playSound('click-sound');
            
            if (currentStep > 0) {
                loadStep(currentFood, currentStep - 1);
            }
            
            setTimeout(() => { isProcessingClick = false; }, 300);
        }
        
        // é¡¯ç¤ºå®Œæˆç•«é¢
        function showCompletionScreen() {
            interactionContent.innerHTML = '';
            stepsIndicator.classList.add('hidden');
            ingredientCounterDisplay.classList.add('hidden');
            prevStepButton.classList.add('hidden');
            nextStepButton.classList.add('hidden');
            
            const completionScreen = document.createElement('div');
            completionScreen.className = 'completion-screen';
            
            // è¨ˆç®—ç¸½åˆ†
            const timeElapsed = (Date.now() - gameState.startTime) / 1000;
            let totalScore = 100;
            
            // æ¸›å°‘éŒ¯èª¤é¸æ“‡çš„æ‡²ç½°
            totalScore -= gameState.wrongSelections * 5;
            
            // å®Œç¾çå‹µ
            if (gameState.perfect) {
                totalScore += 30;
            }
            
            // æ™‚é–“çå‹µï¼ˆå®Œæˆæ™‚é–“å°‘æ–¼30ç§’ï¼‰
            if (timeElapsed < 30) {
                totalScore += Math.floor((30 - timeElapsed) * 1.5);
            }
            
            // é™åˆ¶åˆ†æ•¸åœ¨0-200ä¹‹é–“
            totalScore = Math.max(0, Math.min(200, Math.round(totalScore)));
            
            // è©•åƒ¹
            let evaluation = "";
            let evaluationIcon = "";
            if (totalScore >= 180) {
                evaluation = "ğŸ‘‘ å»šç¥ç´šåˆ¥ï¼å®Œç¾ç„¡ç¼ºï¼";
                evaluationIcon = "ğŸ‘‘";
            } else if (totalScore >= 150) {
                evaluation = "ğŸ‰ å¤§å»šç´šåˆ¥ï¼éå¸¸å‡ºè‰²ï¼";
                evaluationIcon = "ğŸ‰";
            } else if (totalScore >= 120) {
                evaluation = "ğŸ‘ å„ªç§€å»šå¸«ï¼è¡¨ç¾å¾ˆå¥½ï¼";
                evaluationIcon = "ğŸ‘";
            } else if (totalScore >= 90) {
                evaluation = "ğŸ˜Š åˆæ ¼å»šå¸«ï¼ç¹¼çºŒåŠªåŠ›ï¼";
                evaluationIcon = "ğŸ˜Š";
            } else if (totalScore >= 60) {
                evaluation = "ğŸ’ª æ–°æ‰‹å»šå¸«ï¼å¤šåŠ ç·´ç¿’ï¼";
                evaluationIcon = "ğŸ’ª";
            } else {
                evaluation = "ğŸ“š å­¸ç¿’ä¸­ï¼å†è©¦ä¸€æ¬¡ï¼";
                evaluationIcon = "ğŸ“š";
            }
            
            // å‰µå»ºæ˜Ÿç´šè©•åƒ¹
            const starsEarned = Math.floor(totalScore / 40);
            const starRating = document.createElement('div');
            starRating.className = 'star-rating';
            starRating.style.display = 'flex';
            starRating.style.justifyContent = 'center';
            starRating.style.gap = '0.8vh';
            starRating.style.margin = '1.5vh 0';
            starRating.style.fontSize = '2vh';
            
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                if (i <= starsEarned) {
                    star.style.color = '#ffd700';
                } else {
                    star.style.color = '#ddd';
                }
                star.textContent = 'â˜…';
                starRating.appendChild(star);
            }
            
            completionScreen.innerHTML = `
                <div class="completion-icon">${foodSteps[currentFood].icon}</div>
                <div class="completion-message">æ­å–œå®Œæˆ ${foodSteps[currentFood].name}ï¼</div>
                ${starRating.outerHTML}
                <div class="completion-desc">
                    ${evaluationIcon} ${evaluation}<br><br>
                    æŒ‘æˆ°çµ±è¨ˆï¼š<br>
                    - éŒ¯èª¤é¸æ“‡: ${gameState.wrongSelections} æ¬¡<br>
                    - å®Œæˆæ™‚é–“: ${Math.round(timeElapsed)}ç§’<br>
                    - æœ€çµ‚åˆ†æ•¸: ${totalScore}/200åˆ†<br><br>
                    ç¾åœ¨å¯ä»¥ç™»ä¸Šæ’è¡Œæ¦œäº†ï¼
                </div>
            `;
            
            interactionContent.appendChild(completionScreen);
            
            // é¡¯ç¤ºå§“åè¼¸å…¥è¡¨å–®
            setTimeout(() => {
                interactionArea.classList.add('hidden');
                nameForm.classList.remove('hidden');
                finalScoreEl.textContent = totalScore;
                
                // è¨­ç½®ç•¶å‰é¸ä¸­çš„è§’è‰²
                document.querySelectorAll('.character-option').forEach(option => {
                    if (option.dataset.char === selectedCharacter) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
                
                // è‡ªå‹•èšç„¦åˆ°å§“åè¼¸å…¥æ¡†
                playerNameInput.focus();
                
                // é‡ç½®åˆ†æ•¸æäº¤ç‹€æ…‹
                scoreAlreadySubmitted = false;
                submitScoreButton.disabled = false;
                submitScoreButton.textContent = 'ç™»ä¸Šæ’è¡Œæ¦œï¼';
            }, 3000);
            
            // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
            playSound('complete-sound');
            
            // å‰µå»ºç…™èŠ±æ•ˆæœ
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createFirework(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight
                    );
                }, i * 400);
            }
        }
        
        // æäº¤åˆ†æ•¸åˆ°æ’è¡Œæ¦œ
        function submitScore() {
            if (isProcessingClick) return;
            isProcessingClick = true;
            
            // é˜²æ­¢é‡è¤‡æäº¤
            if (scoreAlreadySubmitted) {
                alert("åˆ†æ•¸å·²ç¶“æäº¤éäº†ï¼");
                setTimeout(() => { isProcessingClick = false; }, 300);
                return;
            }
            
            const playerName = playerNameInput.value.trim() || "ç¾é£Ÿé”äºº";
            const finalScore = parseInt(finalScoreEl.textContent);
            
            // ç¦ç”¨æäº¤æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
            submitScoreButton.disabled = true;
            submitScoreButton.textContent = 'å·²æäº¤...';
            
            // æ·»åŠ åˆ°æ’è¡Œæ¦œæ•¸æ“š
            leaderboardData.push({
                name: playerName,
                character: selectedCharacter,
                food: currentFood,
                foodName: foodSteps[currentFood].name,
                score: finalScore,
                date: new Date().toISOString()
            });
            
            // æ’åºæ’è¡Œæ¦œï¼ˆåˆ†æ•¸é«˜åˆ°ä½ï¼‰
            leaderboardData.sort((a, b) => b.score - a.score);
            
            // é™åˆ¶æ’è¡Œæ¦œæ•¸é‡
            if (leaderboardData.length > 50) {
                leaderboardData = leaderboardData.slice(0, 50);
            }
            
            // ä¿å­˜éŠæˆ²æ•¸æ“š
            saveGameData();
            
            // æ¨™è¨˜åˆ†æ•¸å·²æäº¤
            scoreAlreadySubmitted = true;
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸¦è·³è½‰åˆ°æ’è¡Œæ¦œ
            setTimeout(() => {
                alert(`ğŸ‰ ${playerName}ï¼Œä½ çš„åˆ†æ•¸ ${finalScore} åˆ†å·²ç™»ä¸Šæ’è¡Œæ¦œï¼`);
                
                // éš±è—å§“åè¼¸å…¥è¡¨å–®
                nameForm.classList.add('hidden');
                
                // è·³è½‰åˆ°æ’è¡Œæ¦œé é¢
                leaderboardArea.classList.remove('hidden');
                updateLeaderboard('all');
                
                isProcessingClick = false;
            }, 500);
        }
        
        // æ›´æ–°æ’è¡Œæ¦œ
        function updateLeaderboard(foodType) {
            leaderboardBody.innerHTML = '';
            
            // ç¯©é¸æ•¸æ“š
            let filteredData = [...leaderboardData];
            if (foodType !== 'all') {
                filteredData = leaderboardData.filter(item => item.food === foodType);
            }
            
            // é¡¯ç¤ºå‰20å
            const displayData = filteredData.slice(0, 20);
            
            if (displayData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 3vh; font-size: 1vh; color: #666;">
                        é‚„æ²’æœ‰æŒ‘æˆ°è¨˜éŒ„ï¼Œå¿«ä¾†æˆç‚ºç¬¬ä¸€å€‹å§ï¼
                    </td>
                `;
                leaderboardBody.appendChild(row);
                return;
            }
            
            displayData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                // æ’åæ¨£å¼
                let rankClass = '';
                let medal = '';
                if (index === 0) {
                    rankClass = 'rank-1';
                    medal = 'ğŸ¥‡ ';
                } else if (index === 1) {
                    rankClass = 'rank-2';
                    medal = 'ğŸ¥ˆ ';
                } else if (index === 2) {
                    rankClass = 'rank-3';
                    medal = 'ğŸ¥‰ ';
                }
                
                row.innerHTML = `
                    <td class="${rankClass}">${medal}ç¬¬${index + 1}å</td>
                    <td>${item.character} ${item.name}</td>
                    <td>${item.foodName}</td>
                    <td class="${rankClass}">${item.score}åˆ†</td>
                `;
                
                leaderboardBody.appendChild(row);
            });
        }
        
        // å‰µå»ºç…™èŠ±æ•ˆæœ
        function createFirework(x, y) {
            const colors = ['#ff0000', '#ffd700', '#00ff00', '#00aaff', '#ff00ff'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            const firework = document.createElement('div');
            firework.className = 'fireworks';
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            firework.style.backgroundColor = color;
            firework.style.boxShadow = `0 0 1.5vh ${color}`;
            
            document.body.appendChild(firework);
            
            // ç…™èŠ±çˆ†ç‚¸æ•ˆæœ
            let size = 5;
            let opacity = 1;
            const explode = () => {
                size += 8;
                opacity -= 0.05;
                
                firework.style.width = size + 'px';
                firework.style.height = size + 'px';
                firework.style.left = (x - size/2) + 'px';
                firework.style.top = (y - size/2) + 'px';
                firework.style.opacity = opacity;
                firework.style.borderRadius = size % 2 === 0 ? '50%' : '40%';
                
                if (opacity > 0) {
                    requestAnimationFrame(explode);
                } else {
                    firework.remove();
                }
            };
            
            explode();
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
